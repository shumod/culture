<?php

module_load_include('inc', 'culture', 'functions');

/**
 * Implements hook_menu().
 */
function culture_menu() {
 
  //места
  $items['places'] = array(
    'title' => 'Места',
    'page callback' => '_places',
    'access arguments' => array('administer site configuration'),
    'file' => 'inc/places.culture.inc',  
    'type' => MENU_NORMAL_ITEM,
  );

  $items['places/%'] = array(
    'page callback' => '_place',
    'page arguments' => array(1),
    'access arguments' => array('administer site configuration'),
    'file' => 'inc/places.culture.inc',
    'type' => MENU_NORMAL_ITEM,
  );

  //события
  $items['events'] = array(
    'title' => 'События',
    'page callback' => '_events',
    'access arguments' => array('administer site configuration'),
    'file' => 'inc/events.culture.inc',
    'type' => MENU_NORMAL_ITEM,
  );

  $items['events/%'] = array(
    'page callback' => '_event',
    'page arguments' => array(1),
    'access arguments' => array('administer site configuration'),
    'file' => 'inc/events.culture.inc',
    'type' => MENU_NORMAL_ITEM,
  );

  //организации
  $items['organizations'] = array(
    'title' => 'Организации',
    'page callback' => '_organizations',
    'access arguments' => array('administer site configuration'),
    'file' => 'inc/organizations.culture.inc',
    'type' => MENU_NORMAL_ITEM,
  );

  $items['organizations/%'] = array(
    'page callback' => '_organization',
    'page arguments' => array(1),
    'access arguments' => array('administer site configuration'),
    'file' => 'inc/organizations.culture.inc',
    'type' => MENU_NORMAL_ITEM,
  ); 

  //локали
  $items['reload-locales'] = array(
    'title' => 'Обновление списка локалей',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('locales_form'),
    'file' => 'inc/batch.culture.inc',
    'access arguments' => array('administer site configuration'),
  );

  //сайтмэп
  $items['sitemap.txt'] = array(
    'page callback' => '_main_sitemap',
    'file' => 'inc/sitemap.inc',
    'access arguments' => array('View published content'), 
    'type' => MENU_CALLBACK, 
  );
  $items['events.txt'] = array(
    'page callback' => '_events_sitemap',
    'file' => 'inc/sitemap.inc',
    'access arguments' => array('View published content'), 
    'type' => MENU_CALLBACK, 
  );
  $items['places.txt'] = array(
    'page callback' => '_places_sitemap',
    'file' => 'inc/sitemap.inc',
    'access arguments' => array('View published content'), 
    'type' => MENU_CALLBACK, 
  );
  $items['organizations.txt'] = array(
    'page callback' => '_organizations_sitemap',
    'file' => 'inc/sitemap.inc',
    'access arguments' => array('View published content'), 
    'type' => MENU_CALLBACK, 
  );

  return $items;
}

/**
 * Implements hook_theme.
 */
function culture_theme() {
  return array(

    //темплейт для страницы списка мест
    'places' => array(
      'variables' => array(
        'title' => NULL,
      ),
      'template' => 'templates/places',
    ),

    //темплейт для страницы места
    'place' => array(
      'variables' => array(
        'title' => NULL,
      ),
      'template' => 'templates/place',
    ),

    //темплейт для страницы списка событий
    'events' => array(
      'variables' => array(
        'title' => NULL,
      ),
      'template' => 'templates/events',
    ),

    //темплейт для страницы события
    'event' => array(
      'variables' => array(
        'title' => NULL,
      ),
      'template' => 'templates/event',
    ),

    //темплейт для страницы организации
    'organization' => array(
      'variables' => array(
        'title' => NULL,
      ),
      'template' => 'templates/organization',
    ),

  );
}

/**
 * Implements hook_block_info().
 */
function culture_block_info() {
  $blocks['culture-region'] = array(
    'info' => 'Блок выбора региона',
    'cache' => DRUPAL_NO_CACHE,
  );
  return $blocks;
}
 
/**
 * Implements hook_block_view().
 */
function culture_block_view($delta = '') {
  $block = array();
  switch ($delta) {
    case 'culture-region':
      $block['subject'] = 'Выберите регион';
      //рендерим форму выбора региона
      $block['content'] = drupal_render(drupal_get_form('_select_region_form'));
      drupal_add_library('system','jquery.cookie'); //добавляем куки, чтобы записать регион
      break;
  }
  return $block;
}